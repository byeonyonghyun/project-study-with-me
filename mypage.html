<!-- ✅ src/main/resources/static/mypage.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
<h2 class="mb-4">🙋‍♀️ 내 정보</h2>

<div id="userInfo" style="display:none;">
    <form id="updateForm" onsubmit="event.preventDefault(); updateUser();">
        <div class="mb-2">
            <label class="form-label">이름</label>
            <input type="text" id="name" name="name" class="form-control">
        </div>
        <div class="mb-2">
            <label class="form-label">나이</label>
            <input type="number" id="age" name="age" class="form-control">
        </div>
        <div class="mb-2">
            <label class="form-label">성별</label>
            <input type="text" id="gender" name="gender" class="form-control">
        </div>
        <div class="mb-2">
            <label class="form-label">닉네임</label>
            <input type="text" id="nickname" name="nickname" class="form-control" readonly>
        </div>
        <div class="mb-2">
            <label class="form-label">이메일</label>
            <input type="email" id="email" name="email" class="form-control" readonly>
        </div>
        <div class="mb-2">
            <label class="form-label">직업</label>
            <input type="text" id="job" name="job" class="form-control">
        </div>
        <div class="mb-2">
            <label class="form-label">전공</label>
            <input type="text" id="major" name="major" class="form-control">
        </div>
        <div class="mb-2">
            <label class="form-label">관심 분야</label>
            <input type="text" id="interest" name="interest" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">권한</label>
            <input type="text" id="role" name="role" class="form-control" readonly>
        </div>

        <button type="submit" class="btn btn-success">정보 수정</button>
    </form>
</div>

<hr class="my-4">

<div class="d-flex justify-content-between">
    <a href="/main.html" class="btn btn-secondary">⬅ 메인으로</a>
    <form id="logoutForm" action="/users/logout" method="post">
        <button type="submit" class="btn btn-outline-danger">로그아웃</button>
    </form>
</div>

<script>
    // ✅ 페이지 열리자마자 정보 자동 불러오기
    window.onload = function () {
        fetch('/users/me')
            .then(response => {
                if (!response.ok) throw new Error("로그인 필요");
                return response.json();
            })
            .then(user => {
                document.getElementById("userInfo").style.display = "block";
                document.getElementById("name").value = user.name;
                document.getElementById("age").value = user.age;
                document.getElementById("gender").value = user.gender;
                document.getElementById("nickname").value = user.nickname;
                document.getElementById("email").value = user.email;
                document.getElementById("job").value = user.job;
                document.getElementById("major").value = user.major;
                document.getElementById("interest").value = user.interest;
                document.getElementById("role").value = user.role;
            })
            .catch(err => {
                alert("⛔ 로그인 후 이용해주세요.");
                window.location.href = "/login.html";
            });
    }

    // ✅ 사용자 정보 수정
    function updateUser() {
        const user = {
            name: document.getElementById("name").value,
            age: parseInt(document.getElementById("age").value),
            gender: document.getElementById("gender").value,
            job: document.getElementById("job").value,
            major: document.getElementById("major").value,
            interest: document.getElementById("interest").value
        };

        fetch('/users/update', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(user)
        })
        .then(response => {
            if (response.ok) {
                alert("✅ 수정 완료!");
            } else {
                alert("❌ 수정 실패. 다시 시도해주세요.");
            }
        });
    }
</script>
</body>
</html>
